{% extends 'base.html' %}

{% block content %}
    <h1>Work page</h1>
    <div class="order">
        <button class="get-order">Get order</button>
    </div>
    <button class="end-order" style="display: none;">Завершить заказ</button>
{% endblock %}

{% block script %}
    <script>
        document.addEventListener("DOMContentLoaded", (event) => {
            csrftoken = Cookies.get('csrftoken')
            const getOrder = document.querySelector('.get-order')
            const order = document.querySelector('.order')
            const endOrder = document.querySelector('.end-order')
            getOrder.addEventListener('click', function() {

                fetch('', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    }
                })
                .then(response => response.text())
                .then(html => {
                    order.innerHTML = html
                    endOrder.style.display = 'block'
                    const orderId = document.getElementById('order-id').value

                    endOrder.dataset.orderId = orderId
                })
            })
            endOrder.addEventListener('click', function() {
                const orderId = this.dataset.orderId
                fetch(`end/${orderId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'succes') {
                        order.innerHTML = '<button class="get-order">Get order</button>'
                        endOrder.style.display = 'none'
                    }
                })
            })
            
        })
    </script>
{% endblock %}